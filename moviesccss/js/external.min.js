!function(){"use strict";var p=function o(e,t,i){if(e){"function"==typeof t&&(i=t,t=null),i=i||function(){};var r=!navigator.clipboard;"string"!=typeof e||t||(!1===t&&(r=!0),t=e,e=null);var a=document.querySelector("#tempTextarea");!a&&r&&((a=document.createElement("textarea")).style.display="block",a.style.width="10px",a.style.height="10px",a.style.position="fixed",a.style.left="-999px",a.style.top="10px",a.setAttribute("readonly","readonly"),document.body.appendChild(a));var d=function(e,n){n=n||function(){},r?(a.value=e,a.select(),document.execCommand("copy",!0),n(),i(e)):navigator.clipboard.writeText(e).then(function(){n(),i(e)},function(){o(e,!1),n(),i(e)})};if(e){e.addEventListener("click",function(n){var e=t;t&&t.tagName&&(e=t.textContent||t.value),e&&d(e,function(){var e=document.createElement("span");e.className="text-popup",e.innerHTML="复制成功",document.body.appendChild(e),e.addEventListener("animationend",function(){e.parentNode.removeChild(e)}),history.pushState||setTimeout(function(){e.parentNode.removeChild(e)},1e3),e.style.left=n.pageX-e.clientWidth/2+"px",e.style.top=n.pageY-e.clientHeight+"px"})});var n=document.querySelector("#popupStyle");n||((n=document.createElement("style")).id="popupStyle",n.innerHTML=".text-popup { animation: textPopup 1s both; -ms-transform: translateY(-20px); color: #01cf97; user-select: none; white-space: nowrap; position: absolute; z-index: 99; }@keyframes textPopup {0%, 100% { opacity: 0; } 5% { opacity: 1; } 100% { transform: translateY(-50px); }}",document.head.appendChild(n))}else d(t)}},i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=navigator.userAgent,e=/MicroMessenger\/([\d\.]+)/.exec(r),n=0;if(e){var o=e[0].match(/\d+/g);o[2]&&9<o[2]&&(o[2]=9),n=o.join("")}var f={pt:/iPad|iPhone|iPod/.test(r)&&!/Android/.test(r)?"ios":/Android/.test(r)||/MiuiBrowser/.test(r)?"adr":"ubook",vw:r.match(/MicroMessenger\/([\d\.]+)/)?"wx":r.match(/(?:\bV1_AND_SQI?_|QQ\/)([\d\.]+)/)?"qq":r.match(/\bWeibo/)?"wb":r.match(/\bQQLiveBrowser/)?"tv":"ot",sv:/iPad|iPhone|iPod/.test(r)&&!/Android/.test(r)?"iosmain":/Android/.test(r)?"andmain":"ubook",ua:r,wv:n},a={getParam:function(e,n){var o=new RegExp("(?:\\?|#|&)"+e+"=([^&#?]*)(?:$|&|#)","i").exec(n||window.location.href);return o?o[1]:""},share:function(e,n){a.getParam("resh_by","");var o={img:e.cover,url:e.url,title:e.title,desc:e.desc};function t(){WeixinJSBridge.on("menu:share:appmessage",function(e){WeixinJSBridge.invoke("sendAppMessage",{img_url:o.img,img_width:"70",img_height:"100",link:o.url,desc:o.desc,title:o.title},function(e){console.log("shareRes",e.err_msg),n()})}),WeixinJSBridge.on("menu:share:timeline",function(e){WeixinJSBridge.invoke("shareTimeline",{img_url:o.img,img_width:"70",img_height:"100",link:o.url,desc:o.title,title:o.title},function(e){console.log("shareRes",e.err_msg),n()})}),WeixinJSBridge.on("menu:share:qq",function(e){WeixinJSBridge.invoke("shareQQ",{title:o.title,desc:o.desc,link:o.url,img_url:o.img},function(e){console.log("shareRes",e.err_msg),n()})}),WeixinJSBridge.on("menu:share:weibo",function(e){WeixinJSBridge.invoke("shareWeibo",{content:o.desc,url:o.url},function(e){console.log("shareRes",e.err_msg),n()})})}return"object"==("undefined"==typeof WeixinJSBridge?"undefined":i(WeixinJSBridge))&&"function"==typeof WeixinJSBridge.invoke?t():document.addEventListener("WeixinJSBridgeReady",t,!1),{set:function(e){e&&(o.title=e.title||o.title,o.url=e.url||o.url,o.img=e.img||o.img,o.desc=a.cutstr(e.desc||o.desc,40))}}},checkDownloadApp:function(o){function e(){WeixinJSBridge.invoke("getInstallState",{packageName:"com.qq.reader",packageUrl:"qqreader://"},function(e){var n=e.err_msg;-1<n.indexOf("get_install_state:yes")?o(!0,n.substring(22,n.length)):o(!1)})}"object"==("undefined"==typeof WeixinJSBridge?"undefined":i(WeixinJSBridge))&&"function"==typeof WeixinJSBridge.invoke?e():document.addEventListener("WeixinJSBridgeReady",e,!1)},checkDownloadAppYyb:function(o){function e(){WeixinJSBridge.invoke("getInstallState",{packageName:"com.tencent.android.qqdownloader",packageUrl:"qqreader://"},function(e){var n=e.err_msg;-1<n.indexOf("get_install_state:yes")?o(!0,n.substring(22,n.length)):o(!1)})}"object"==("undefined"==typeof WeixinJSBridge?"undefined":i(WeixinJSBridge))&&"function"==typeof WeixinJSBridge.invoke?e():document.addEventListener("WeixinJSBridgeReady",e,!1)},launchApplication:function(e){setTimeout(function(){WeixinJSBridge.invoke("launchApplication",{schemeUrl:e||"uniteqqreader://nativepage/infostream/list"},function(e){var n="";for(var o in e){n+=e[o]}var t=n.indexOf(":");"fail"==n.substring(t+1,n.length)&&(window.location=g.APPSTORE)})})},wxLaunch:function(e){window.WeixinJSBridge?a.launchApplication(e):document.addEventListener("WeixinJSBridgeReady",function(){a.launchApplication(e)})}},d={checkDownloadApp:function(e){function n(n){TenvideoJSBridge.invoke("isInstalled",{pkgName:"com.qq.reader",pkgUrl:"qqreader://",appName:"QQ阅读"},function(e){n(JSON.parse(e).result.installed)})}TenvideoJSBridge?n(e):document.addEventListener("onTenvideoJSBridgeReady",function(){n(e)},!1)},launchApplication:function(n){setTimeout(function(e){console.log("launchApplication"),TenvideoJSBridge.invoke("launch3rdApp",{pkgName:"com.qq.reader",pkgUrl:n||"uniteqqreader://nativepage/infostream/list",appName:"QQ阅读"})},100)},tvLaunch:function(e){window.TenvideoJSBridge?d.launchApplication(e):document.addEventListener("onTenvideoJSBridgeReady",function(){d.launchApplication(e)})}},m={android_downloadurlYYB:"http://a.app.qq.com/o/simple.jsp?pkgname=com.qq.reader",packageName:"com.qq.reader",getDownloadurl:function(e){return"https://qqdownload.reader.qq.com/qqreader/apknew/source/"+(e=e||"10000285")+".apk"},openByChannel:function(n,o,t,i){"wx"==f.vw||"qq"==f.vw?c.checkQQReader(function(e){if(e)"wx"==f.vw?a.wxLaunch(n):window.location.href=n;else{if(i&&i(),"qq"==f.vw&&window.navigator.userAgent.match(/\((.+?)\)/)[1].includes("Pixel"))return void(window.location.href="https://yuedu.reader.qq.com/common/common/downloadIntro/index.html?tf=1&url="+encodeURIComponent(m.getDownloadurl(o)));window.location.href=m.getDownloadurl(o)}}):"tv"==f.vw?c.checkQQReader(function(e){e?d.tvLaunch(n):(TenvideoJSBridge.on("onDownloadTaskStateChanged",function(e){console.log("onDownloadTaskStateChanged",e),16==e.state&&TenvideoJSBridge.invoke("toast",{content:"开始下载"})}),TenvideoJSBridge.on("onDownloadTaskProgressChanged",function(e){console.log("onDownloadTaskProgressChanged",e),t&&t(e)}),TenvideoJSBridge.invoke("download3rdApp",{downloadUrl:"https://ff64f87043714024d67fa1786691cbc7.dlied1.cdntips.net/ug.channel.qq.com/ugApkPack/prod/740/2006002437-740-qqreader_7.5.7.888_android_20210202161142_21d22e876_common-release.apk",packageName:"com.qq.reader",iconUrl:"https://ubook.reader.qq.com/img/qq-logo.png",appName:"QQ阅读"}))}):c.openAPPfromBrowser(n,m.getDownloadurl(o),i)},openByYYB:function(n){"wx"==f.vw||"qq"==f.vw?c.checkQQReader(function(e){e?"wx"==f.vw?a.wxLaunch(n):window.location.href=n:c.checkYYB(function(e){if(e)"wx"==f.vw?a.wxLaunch(m.android_downloadurlYYB):window.location.href=m.android_downloadurlYYB;else{if("qq"==f.vw&&window.navigator.userAgent.match(/\((.+?)\)/)[1].includes("Pixel"))return void(window.location.href="https://yuedu.reader.qq.com/common/common/downloadIntro/index.html?tf=1&url="+encodeURIComponent(m.getDownloadurl()));window.location.href=m.getDownloadurl()}})}):c.openAPPfromBrowser(n,m.getDownloadurl())}},g={APPSTORE:"https://itunes.apple.com/cn/app/qq-yue-du/id487608658?mt=8",getUrlScheme:function(e){var n={url:""+e};return"qqreader://com.tencent.reader?action=openUrl&parameter="+encodeURIComponent(JSON.stringify(n))},open:function(e,n){var o=1<arguments.length&&void 0!==n?n:g.APPSTORE,t=navigator.userAgent.toLowerCase(),i=-1<t.indexOf("applewebkit")&&-1<t.indexOf("mobile")&&-1<t.indexOf("safari")&&-1===t.indexOf("linux")&&-1===t.indexOf("android")&&-1===t.indexOf("chrome")&&-1===t.indexOf("ios")&&-1===t.indexOf("browser");"qq"==f.vw||i||0<=r.toLowerCase().indexOf("baidu")?location.href="https://newios.reader.qq.com/"+e:"wx"==f.vw?a.wxLaunch(e):c.openAPPfromBrowser(e,o)}},c={share:function(e,n){if(console.log("setShare",e),"wx"==f.vw)try{a.share(e,n)}catch(e){}else if("qq"==f.vw)try{mqq.data.setShareInfo({image_url:e.cover,share_url:e.url,title:e.title,desc:e.desc})}catch(e){}else"wb"==f.vw&&console.log("setShare at weibo")},checkQQReader:function(o){if("wx"==f.vw)a.checkDownloadApp(function(e,n){o(e,f.pt)});else if("qq"==f.vw){var e;e="ios"==f.pt?"qqreader":"com.qq.reader",mqq.app.isAppInstalled(e,function(e){o(e,f.pt)})}else"tv"==f.vw?d.checkDownloadApp(function(e,n){console.log("hasDownloadApp",e),o(e,f.pt)}):o(-2,f.pt)},checkYYB:function(o){if("wx"==f.vw)"ios"==f.pt?a.checkDownloadApp(function(e,n){o(e,f.pt)}):a.checkDownloadAppYyb(function(e,n){o(e,f.pt)});else if("qq"==f.vw){var e;e="ios"==f.pt?"qqreader":"com.tencent.android.qqdownloader",mqq.app.isAppInstalled(e,function(n){n&&"ios"!==f.pt?mqq.app.checkAppInstalled(e,function(e){o(n,f.pt)}):o(n,f.pt)})}else o(-2,f.pt)},openApp:function(e){"adr"==f.pt?e?m.openByChannel("uniteqqreader://nativepage/infostream/list",e):m.openByYYB("uniteqqreader://nativepage/infostream/list"):"ios"==f.pt&&g.open("qqreader://com.tencent.reader")},openReaderApp:function(e){var n=e.url,o=e.channelId,t=e.callback,i=e.startReport,r=e.readershare,a=void 0===r?"":r,d=n||"uniteqqreader://nativepage/infostream/list",c=d.match(/(http[s]?:\/\/([\w-]+.)+([:\d+])?(\/[\w-./?%&=]*)?)/gi)||[];if(1===c.length){if(-1===new URL(decodeURIComponent(c[0])).host.indexOf(".qq.com"))return;d=0===d.indexOf("uniteqqreader")?d:"uniteqqreader://webpage/"+d}var l=d.indexOf("queryforuser=$readershare"),s="",u="";-1===l?s=d:(s=d.slice(0,l),u=d.slice(l)),s=(s=-1!==(s=s.replace(/(&|\?)+$/,"")).indexOf("?")?s+"&"+(a||u):s+"?"+(a||u)).replace(/(&|\?)+$/,""),p(s,function(){console.log("scheme: "+s),console.log("剪切板: "+s),"adr"==f.pt&&(o?m.openByChannel(s,o,t,i):m.openByYYB(s)),"ios"==f.pt&&g.open(s)})},openPage:function(e,n,o){if("adr"==f.pt)n?m.openByChannel("uniteqqreader://webpage/"+e,n,o):m.openByYYB("uniteqqreader://webpage/"+e);else if("ios"==f.pt){var t=0===e.indexOf("uniteqqreader")?e:"uniteqqreader://webpage/"+e;g.open(t)}},openNativePage:function(e,n,o,t){"adr"==f.pt?n?m.openByChannel(e,n,o,t):m.openByYYB(e):"ios"==f.pt&&g.open(e)},adrDownloadurl:function(e){return console.log("adrDownloadurl",e),m.getDownloadurl(e)},openAPPfromBrowser:function(e,n,o){if(0<=r.toLowerCase().indexOf("baidu"))return window.location.href=n,void(o&&o());!function(e,n,o){var t=1<arguments.length&&void 0!==n?n:4e3,i=o;if(!document.querySelector("#openappToastActive")){var r=document.createElement("div");r.id="openappToastActive",r.style="position:fixed;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);z-index:5000;padding:10px 15px;text-align:center;color:#fff;font-size:14px;background:rgba(0,0,0,0.9);border-radius:20px;",r.innerHTML=e,document.body.appendChild(r),clearTimeout(a);var a=setTimeout(function(){document.body.removeChild(r),i&&i()},t)}}("正在打开APP...");var t=+new Date;window.location.href=e;var i=setTimeout(function(){console.log("延时下载"),+new Date-t<5e3?(location.href=n,o&&o()):clearTimeout(i)},3e3);document.addEventListener("visibilitychange",function(){console.log("离开当前页面清除定时器"),"hidden"===document.visibilityState&&clearTimeout(i)})}};window.External=c,window.env=f}();
